{% extends 'base.html' %}
{% load static %}

{% block style %}
<title>AMBMUN | {{ committee.name }} Committee Details</title>
<style>
    body {
        overflow-x: hidden;
    }
</style>
<!-- Your existing styles here -->

{% endblock %}

{% block content %}
<img class='committeeLogo background' id="bgimg">
<a class="desktopmargin" href="{% url 'committees' %}" style="width: auto; margin-bottom: 10px; padding-bottom: 5px;">
    <h2 style="font-family: Loverica; font-size: 20px; margin: 0; padding: 0;"><- Committees</h2>
</a>
<h1 class="header desktopmargin" style="text-align: left; margin-top: 0px;">{{ committee.name }}</h1>
<div class="banner content">
    <p style="color: white;">{{ committee.about }}</p>
</div>
<h2 class="header desktopmargin">Topic</h2>
<p class="desktopmargin" style='margin-top: 5px; font-size: 20px; padding-right: 20px;'>{{ committee.topic }}</p>

<h2 class="header desktopmargin">Background Guide</h2>
{% if committee.background_guide %}
<!-- Note: The Word View feature only works when the site is running on a hosted server that can be accessed through internet (not localhost), download feature works on all methods of hosting (localhost and mun domain) -->
<a class="desktopmargin" style="text-transform: none; margin-top: 5px;" onclick="createWordViewer(location.protocol + '//' + location.host + '{{ committee.background_guide.url }}');">Click Here to View</a>
{% else %}
<p class="desktopmargin">Background guide is not available.</p>
{% endif %}
<div class="cardgrid" style="margin-bottom: 100px; gap: 200px;">
    <div class="columnCenterer">
        <h2 class="header" style="margin-bottom: 30px;">Chairs</h2>
        <div class="cardgrid">
            {% for chair in committee.chairs.all %}
            <div class="card">
                <img class='cardImage' src="{{chair.photo.url}}">
                <p class="cardMain">{{ chair.name }}</p>
                <p class="cardSub">{{ chair.email }}</p>
                <div class="centerer">
                <button class="cardBtn" onclick="document.getElementById('{{chair.id}}').classList.toggle('hidden')">More Info</button>
            </div>
            <p class="cardSub hidden" id="{{chair.id}}">{{ chair.about }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% if committee.pagers.all %}
    <div class="columnCenterer">
        <h2 class="header" style="margin-bottom: 30px;">Pager</h2>
        <div class="cardgrid">
            {% for pager in committee.pagers.all %}
            <div class="card">
                <img class='cardImage' src="{{pager.photo.url}}">
                <p class="cardMain">{{ pager.name }}</p>
                <p class="cardSub">{{ pager.email }}</p>
                <div class="centerer">
                <button class="cardBtn" onclick="document.getElementById('{{pager.id}}').classList.toggle('hidden')">More Info</button>
            </div>
            <p class="cardSub hidden" id="{{pager.id}}">{{ pager.about }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
<script>
    var emails = document.getElementsByClassName("cardemail");
    for (var i = 0; i < emails.length; i++) {
        emails[i].onclick = function () {
            navigator.clipboard.writeText(this.innerHTML);
            document.title = "Copied to clipboard";
            setTimeout(function () {
                document.title = "{{ committee.name }} - AMBMUN | Committee Detail";
            }, 1000);
        }
    }
    function createWordViewer(url) {
        var popupRoot = document.createElement("div");
        popupRoot.style.position = "fixed";
        popupRoot.style.left = "0px";
        popupRoot.style.top = "0px";
        popupRoot.style.width = "100%";
        popupRoot.style.height = "100%";
        popupRoot.style.zIndex = "11";
        popupRoot.style.backgroundColor = "rgba(0,0,0,0.5)";
        popupRoot.addEventListener("click", function(event) {
            if(event.srcElement == this) {
                this.remove();
            }
        });
        var popupSubroot = document.createElement("div");
        popupSubroot.style.position = "fixed";
        popupSubroot.style.left = "100px";
        popupSubroot.style.top = "50px";
        popupSubroot.style.width = "calc(100% - 200px)";
        popupSubroot.style.height = "calc(100% - 100px)";
        popupSubroot.style.zIndex = "12";
        popupSubroot.style.backgroundColor = "rgba(255,255,255,1)";
        popupSubroot.style.display = "flex";
        popupSubroot.style.flexDirection = "column";
        var toolbar = document.createElement("div");
        toolbar.style.width = "100%;";
        toolbar.style.height = "30px";
        toolbar.style.boxShadow = "0px 0px 5px 1px gray";
        toolbar.style.display = "flex";
        toolbar.style.justifyContent = "end";
        toolbar.style.alignItems = "center";
        var closeButton = document.createElement("button");
        closeButton.style = "border: none; background: none; color: red;";
        closeButton.innerText = "X";
        closeButton.addEventListener("click", function() {
            this.parentElement.parentElement.parentElement.remove();
        });
        var downloadButton = document.createElement("button");
        downloadButton.style = "border: none; background: none; font-size: 12px;";
        downloadButton.innerText = "Download";
        downloadButton.addEventListener("click", function() {
            var a = document.createElement("a");
            a.href = url;
            a.target = "_blank";
            a.download = true;
            a.click();
            a.remove();
        });
        toolbar.appendChild(downloadButton);
        toolbar.appendChild(closeButton);
        popupSubroot.appendChild(toolbar);
        var wordViewer = document.createElement("iframe");
        wordViewer.src = "https://docs.google.com/gview?url=" + url + "&embedded=true";
        // wordViewer.src = "https://view.officeapps.live.com/op/embed.aspx?src=http%3A%2F%2Fieee802%2Eorg%3A80%2Fsecmail%2FdocIZSEwEqHFr%2Edoc";
        wordViewer.height = "100%";
        wordViewer.width = "100%";
        wordViewer.frameBorder = "0";
        popupSubroot.appendChild(wordViewer);
        popupRoot.appendChild(popupSubroot);
        document.body.appendChild(popupRoot);
    }
    var userAgentt = navigator.userAgent;
    if (userAgentt.toLowerCase().indexOf('iphone') > -1 || userAgentt.toLowerCase().indexOf('android') > -1) {
        console.log("this is a phone");
        document.getElementById('bgimg').style.backgroundImage = 'url({{ committee.photo.url }})';
    } else {
        document.getElementById('bgimg').src = '{{ committee.photo.url }}';
    }
</script>
{% endblock %}
